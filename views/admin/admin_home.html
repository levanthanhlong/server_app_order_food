<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Trang Admin - Quáº£n lÃ½ MÃ³n Ä‚n</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <link href="../../assets/css/home_admin.css" rel="stylesheet" />
  </head>
  <body>
    <aside class="sidebar">
      <h1>Admin MÃ³n Ä‚n</h1>
      <nav>
        <ul>
          <li><a href="/homeAdmin">ğŸ½ï¸ Quáº£n lÃ½ mÃ³n Äƒn</a></li>
          <li>
            <a href="/homeAdmin/userManagerPage">ğŸ‘¥ Quáº£n LÃ½ NgÆ°á»i DÃ¹ng</a>
          </li>
          <li><a href="/api/user/logout" class="logout">ğŸšª ÄÄƒng Xuáº¥t</a></li>
        </ul>
      </nav>
    </aside>
    <main class="main-content">
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
        "
      >
        <h2>Danh SÃ¡ch MÃ³n Ä‚n</h2>
        <a href="/homeAdmin/createFoodItem" class="action-btn edit-btn"
          >Táº¡o mÃ³n Äƒn má»›i</a
        >
      </div>
      <table id="foodItemsTable">
        <thead>
          <tr>
            <th>TÃªn MÃ³n Ä‚n</th>
            <th>MÃ´ Táº£</th>
            <th>GiÃ¡ (VNÄ)</th>
            <th>NgÃ y Cung Cáº¥p</th>
            <th>Sá»‘ Ä‘Æ¡n Ä‘áº·t </th>
            <th>HÃ nh Äá»™ng</th>
          </tr>
        </thead>
        <tbody id="foodItemsList">
          <!-- CÃ¡c mÃ³n Äƒn sáº½ Ä‘Æ°á»£c thÃªm vÃ o Ä‘Ã¢y thÃ´ng qua JavaScript -->
        </tbody>
      </table>
    </main>
    <script>
      // Fetch food items vÃ  hiá»ƒn thá»‹ chÃºng
      async function fetchFoodItems() {
        console.log("load-----------------");
        try {
          const res = await fetch("/api/foodItems/getAllFoodItems", {
            method: "GET",
            cache: "no-store", // láº¥y dá»¯ liá»‡u má»›i tá»« server
          });
          const foodItemsList = document.getElementById("foodItemsList");
          foodItemsList.innerHTML = ""; //xÃ³a DS hiá»ƒn thá»‹ hiá»‡n cÃ³
          const result = await res.json(); //convert sang json -> gÃ¡n cho biáº¿n
          if (!result.data || result.data.length === 0) {
            foodItemsList.innerHTML =
              "<tr><td colspan='5'>KhÃ´ng cÃ³ mÃ³n Äƒn nÃ o.</td></tr>";
            return;
          }
          // DÃ¹ng forEach Ä‘á»ƒ duyá»‡t qua tá»«ng ptá»­
          result.data.forEach((item) => {
            const row = document.createElement("tr");

            row.innerHTML = `
    <td>${item.name_food}</td>
    <td>${
      item.description.length > 50
        ? item.description.substring(0, 50) + "..."
        : item.description
    }</td>
    <td>${item.price} VNÄ</td>
    <td>${new Date(item.available_date).toLocaleDateString("vi-VN")}</td>
    <td>${item.total_ordered}</td>
    <td>
      <a href="/homeAdmin/updateFoodItem/${
        item.id
      }" class="action-btn edit-btn">Edit</a>
      <a href="#" onclick="deleteFoodItem(${
        item.id
      })" class="action-btn delete-btn">XoÃ¡</a>
    </td>
  `;

            foodItemsList.appendChild(row);
          });
        } catch (error) {
          console.error("Lá»—i khi táº£i danh sÃ¡ch mÃ³n Äƒn:", error);
        }
      }
      //Láº¯ng nghe sá»± kiá»‡n reload -> fá»i hÃ m fetchFoodItems Ä‘á»ƒ láº¥y DS mÃ³n Äƒn
      document.addEventListener("DOMContentLoaded", fetchFoodItems);

      /// function delete food item
        async function deleteFoodItem(id)  {

        if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n xoÃ¡ mÃ³n Äƒn nÃ y khÃ´ng?")) 
        {

         const res = await fetch(`/api/foodItems/deleteFoodItem/${id}`, {
            method: "DELETE",
          });
          // convert response tá»« json -> Ä‘á»‘i tÆ°á»£ng
          const data = await res.json();
          if (data.status === 1) {
                alert(data.message);
                fetchFoodItems(); // load láº¡i danh sÃ¡ch
              } else {
                alert(data.message);
              }
        }
      }
    </script>
  </body>
</html>
